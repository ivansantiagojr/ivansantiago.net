<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    >
    <link rel="stylesheet" href="/blog.css">
    
    <title>Construindo bibliotecas Python com Zig</title>

  </head>
  <body>
    <main class="container">
    <div class="content-container">
        
    <h1>Construindo Bibliotecas Python com Zig - Introdução a Ziggy Pydust</h1>
<h1>Índice</h1>
<ol>
<li>O que é Zig?</li>
<li>"Olá, pessoas!" em Zig</li>
<li>Por que Zig me interessou?</li>
<li>Ziggy Pydust</li>
<li>Referências</li>
</ol>
<h2>O que é Zig?</h2>
<p>Da <a href="https://ziglang.org/">documentação</a>, Zig é:</p>
<blockquote>
<p>uma linguagem de programação de proposito geral e um conjunto de ferramentas
para manter software robusto, otimizado e reutilizável.</p>
</blockquote>
<p>Na prática, isso quer dizer que Zig não é só uma linguagem. Vamos explorar isso
mais pra frente. Antes, vamos ver a cara da linguagem.</p>
<h2>"Olá, pessoas!" em Zig</h2>
<p>A seguir, vamos ver um dos "Hello, world!" mais feios da história. Esta preparado?</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">const</span><span style="color: #BBB"> </span>std<span style="color: #BBB"> </span><span style="color: #666">=</span><span style="color: #BBB"> </span><span style="color: #008000">@import</span>(<span style="color: #BA2121">&quot;std&quot;</span>);

<span style="color: #008000; font-weight: bold">pub</span><span style="color: #BBB"> </span><span style="color: #008000; font-weight: bold">fn</span><span style="color: #BBB"> </span>main()<span style="color: #BBB"> </span><span style="color: #666">!</span><span style="color: #B00040">void</span><span style="color: #BBB"> </span>{
<span style="color: #BBB">    </span><span style="color: #008000; font-weight: bold">try</span><span style="color: #BBB"> </span>std.fs.File.stdout().writeAll(<span style="color: #BA2121">&quot;Olá, Pessoas!</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>);
}
</code></pre></div>
<p>Quanta coisa, eu só queria dizer "oi"...</p>
<h3>Compilando</h3>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #BBB"> </span>zig<span style="color: #BBB"> </span>build-exe<span style="color: #BBB"> </span>hello.zig
$<span style="color: #BBB"> </span>./hello
Olá,<span style="color: #BBB"> </span>pessoas!
</code></pre></div>
<h2>"Olá, pessoas!" em... C?</h2>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #9C6500">#include</span><span style="color: #BBB"> </span><span style="color: #3D7B7B; font-style: italic">&lt;stdio.h&gt;</span>

<span style="color: #B00040">int</span><span style="color: #BBB"> </span><span style="color: #00F">main</span>()<span style="color: #BBB"> </span>{
<span style="color: #BBB">    </span>puts(<span style="color: #BA2121">&quot;Salve, simpatia!&quot;</span>);
<span style="color: #BBB">    </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #BBB"> </span><span style="color: #666">0</span>;
}
</code></pre></div>
<p>Sim! E nós podemos compilar isso com Zig!!</p>
<h3>Compilando</h3>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #BBB"> </span>zig<span style="color: #BBB"> </span>build-exe<span style="color: #BBB"> </span>hello.c<span style="color: #BBB"> </span>-lc
$<span style="color: #BBB"> </span>./hello
Olá,<span style="color: #BBB"> </span>pessoas!
</code></pre></div>
<p>Nesse caso, tivemos que passar a flag <code>-lc</code> para dizer ao Zig para usar a libc (estamos utilizando o módulo <code>stdio</code> da libc.</p>
<h3>Como o Zig consegue compilar a própria linguagem e também C?</h3>
<p>Isso acontece porque o binário de Zig contém o clang (isso deve mudar versões futuras). E tão interessante quanto é que Zig consegue fazer <em>cross-compiling</em>, isto é, compilar o código com arquiteturas e sistemas operacionais alvo diferentes da que o compilador está rodando.</p>
<p>Seguindo o exemplo inicial, nós podemos rodar:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #BBB"> </span>zig<span style="color: #BBB"> </span>build-exe<span style="color: #BBB"> </span>hello.zig<span style="color: #BBB"> </span>-target<span style="color: #BBB"> </span>aarch64-macos
</code></pre></div>
<p>Vamos analisar o binário gerado:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #BBB"> </span>file<span style="color: #BBB"> </span>hello
hello:<span style="color: #BBB"> </span>Mach-O<span style="color: #BBB"> </span><span style="color: #666">64</span>-bit<span style="color: #BBB"> </span>arm64<span style="color: #BBB"> </span>executable,<span style="color: #BBB"> </span>flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|NO_REEXPORTED_DYLIBS|PIE|HAS_TLV_DESCRIPTORS&gt;
</code></pre></div>
<p>Olha que incrível!! Geramos um binário que vai rodar na linha M da apple mesmo eu usando GNU/Linux e um Ryzen 5.</p>
<h1>Por que Zig me interessou?</h1>
<p>Eu gosto muito da linguagem Python, não só pelas features, mas pela comunidade e filosofia também. E nesse quesito, eu vejo que Python e Zig combinam bastante. Em ambas, a fundação mantenedora se preocupa com a qualidade do projeto em si, mas também com as pessoas que o usam. Exemplo: Zig mudando para o <a href="https://codeberg.org/ziglang">codeberg</a>, Python rejeitando dinheiro do governo dos EUA para poder continuar apoiando projetos de inclusão e diversidade.</p>
<p>Mas como podemos programar usando Python e Zig nos nossos projetos?</p>
<h1>Ziggy Pydust</h1>
<p>O Ziggy Pydust é um framework desenvolvido pela SpiralDB para escrever extensões Python em Zig. E já vem com algumas coisas bem legais como:</p>
<ul>
<li>Integração com Pyproject</li>
<li>Plugin Pytest que roda os testes Python e Zig</li>
</ul>
<h1>Referências</h1>
<ol>
<li>Site oficial do <a href="https://ziglang.org/">Zig</a> com documentações, notícias, etc.</li>
<li><a href="https://pedropark99.github.io/zig-book/">Introduction to Zig</a> - Livro brasileiro (mas em inglês) sobre Zig</li>
<li>Documentação do <a href="https://pydust.fulcrum.so/latest/">Ziggy Pydust</a></li>
</ol>

    </div>
    </main>
  </body>
</html>
